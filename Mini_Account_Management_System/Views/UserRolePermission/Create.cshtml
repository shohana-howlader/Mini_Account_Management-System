@model Mini_Account_Management_System.Models.ViewModel.CreateUserRolePermissionViewModel

@{
    ViewData["Title"] = "Create User Role Permission";
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-plus-circle"></i> Create New User Role Permission
                    </h3>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="UserId" class="form-label">
                                        <i class="fas fa-user"></i> User
                                    </label>
                                    <select asp-for="UserId" class="form-control" required>
                                        <option value="">Select User</option>
                                        @foreach (var user in ViewBag.Users)
                                        {
                                            <option value="@user.Id">@user.UserName</option>
                                        }
                                    </select>
                                    <span asp-validation-for="UserId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="RoleId" class="form-label">
                                        <i class="fas fa-user-tag"></i> Role
                                    </label>
                                    <select asp-for="RoleId" class="form-control" required>
                                        <option value="">Select Role</option>
                                        @foreach (var role in ViewBag.Roles)
                                        {
                                            <option value="@role.Id">@role.RoleName</option>
                                        }
                                    </select>
                                    <span asp-validation-for="RoleId" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label asp-for="ScreenId" class="form-label">
                                <i class="fas fa-desktop"></i> Screen
                            </label>
                            <select asp-for="ScreenId" class="form-control" required>
                                <option value="">Select Screen</option>
                                @foreach (var screen in ViewBag.Screens)
                                {
                                    <option value="@screen.Id">@screen.ScreenName</option>
                                }
                            </select>
                            <span asp-validation-for="ScreenId" class="text-danger"></span>
                        </div>

                        <div class="card mt-4">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">
                                    <i class="fas fa-shield-alt"></i> Permission Settings
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="custom-control custom-switch mb-3">
                                            <input type="checkbox" class="custom-control-input" 
                                                   asp-for="CanRead" id="canRead">
                                            <label class="custom-control-label" for="canRead">
                                                <i class="fas fa-eye text-info"></i> Can Read
                                            </label>
                                            <small class="form-text text-muted">
                                                Allow user to view/read data
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="custom-control custom-switch mb-3">
                                            <input type="checkbox" class="custom-control-input" 
                                                   asp-for="CanWrite" id="canWrite">
                                            <label class="custom-control-label" for="canWrite">
                                                <i class="fas fa-pen text-success"></i> Can Write
                                            </label>
                                            <small class="form-text text-muted">
                                                Allow user to create new data
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="custom-control custom-switch mb-3">
                                            <input type="checkbox" class="custom-control-input" 
                                                   asp-for="CanEdit" id="canEdit">
                                            <label class="custom-control-label" for="canEdit">
                                                <i class="fas fa-edit text-warning"></i> Can Edit
                                            </label>
                                            <small class="form-text text-muted">
                                                Allow user to modify existing data
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="custom-control custom-switch mb-3">
                                            <input type="checkbox" class="custom-control-input" 
                                                   asp-for="CanDelete" id="canDelete">
                                            <label class="custom-control-label" for="canDelete">
                                                <i class="fas fa-trash text-danger"></i> Can Delete
                                            </label>
                                            <small class="form-text text-muted">
                                                Allow user to delete data
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <div class="form-group text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg mr-3">
                                <i class="fas fa-save"></i> Create Permission
                            </button>
                            <a href="@Url.Action("Index")" class="btn btn-secondary btn-lg">
                                <i class="fas fa-arrow-left"></i> Back to List
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Form validation enhancement
            $('form').submit(function(e) {
                var hasPermission = $('input[type="checkbox"]:checked').length > 0;
                if (!hasPermission) {
                    e.preventDefault();
                    alert('Please select at least one permission.');
                    return false;
                }
            });

            // Dynamic role-based permissions (optional enhancement)
            $('#RoleId').change(function() {
                var roleId = $(this).val();
                if (roleId) {
                    // You can add AJAX call here to get default permissions for the selected role
                    // and pre-check the appropriate checkboxes
                }
            });

            // Enhanced UX: Disable delete permission if no other permissions are selected
            $('input[type="checkbox"]').change(function() {
                updatePermissionLogic();
            });

            function updatePermissionLogic() {
                var canRead = $('#canRead').is(':checked');
                var canWrite = $('#canWrite').is(':checked');
                var canEdit = $('#canEdit').is(':checked');
                
                // If user can edit, they should be able to read
                if (canEdit && !canRead) {
                    $('#canRead').prop('checked', true);
                }
                
                // If user can write, they should be able to read
                if (canWrite && !canRead) {
                    $('#canRead').prop('checked', true);
                }
            }
        });
    </script>
}

